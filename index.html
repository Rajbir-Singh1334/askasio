<!DOCTYPE html>
<html lang="en">
<head>
Â  <meta charset="UTF-8">
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  <title>Askaio - AI Image Generator</title>
Â  <script src="https://cdn.tailwindcss.com"></script>

Â  <!-- Clerk Frontend SDK -->
Â  <scriptÂ 
Â  Â  asyncÂ 
Â  Â  crossorigin="anonymous"Â 
Â  Â  data-clerk-publishable-key="pk_test_ZXBpYy1haXJlZGFsZS02MS5jbGVyay5hY2NvdW50cy5kZXYk"Â 
Â  Â  src="https://cdn.jsdelivr.net/npm/@clerk/clerk-js@latest/dist/clerk.browser.js">
Â  </script>

Â  <style>
Â  Â  :root {
Â  Â  Â  --color-dark-bg: #211e2f;
Â  Â  Â  --color-panel-bg: #2b283d;
Â  Â  Â  --color-primary: #ecddfa;
Â  Â  Â  --color-primary-dark: #9333ea;
Â  Â  Â  --color-text-light: #d1d5db;
Â  Â  Â  --color-border: #4b4864;
Â  Â  Â  --transition-fast: 0.3s ease;
Â  Â  Â  --transition-slow: 0.6s ease;
Â  Â  }
Â  Â  body {
Â  Â  Â  font-family: 'Inter', sans-serif;
Â  Â  Â  background: var(--color-dark-bg);
Â  Â  Â  margin: 0;
Â  Â  Â  padding: 0;
Â  Â  Â  color: var(--color-text-light);
Â  Â  Â  min-height: 100vh;
Â  Â  Â  display: flex;
Â  Â  Â  flex-direction: column;
Â  Â  }

Â  Â  /* Custom Animation for Landing Page Headline */
Â  Â  @keyframes pulse-slow {
Â  Â  Â  0%, 100% { opacity: 1; }
Â  Â  Â  50% { opacity: 0.8; }
Â  Â  }
Â  Â  .animate-pulse-slow {
Â  Â  Â  animation: pulse-slow 8s infinite ease-in-out;
Â  Â  }
Â  </style>
</head>
<body>
Â  <!-- Header -->
Â  <header class="flex justify-between items-center p-4 bg-[var(--color-panel-bg)]">
Â  Â  <h1 class="text-xl font-bold">Askaio</h1>
Â  Â  <div class="flex items-center gap-4">
Â  Â  Â  <div id="clerk-sign-in"></div>
Â  Â  Â  <div id="clerk-user-button"></div>
Â  Â  </div>
Â  </header>

Â  <!-- Protected Content (only visible when logged in) -->
Â  <main id="protected-content" class="flex-1 hidden">
Â  Â  <div class="main-layout flex flex-col md:flex-row gap-4 p-4 md:p-8">
Â  Â  Â  <!-- Sidebar (Prompt Panel) -->
Â  Â  Â  <aside class="sidebar flex flex-col gap-4 bg-[var(--color-panel-bg)] rounded-2xl shadow-lg p-6 w-full md:w-[400px]" id="sidebar">
Â  Â  Â  Â  <div class="sidebar-header flex justify-between items-center mb-4">
Â  Â  Â  Â  Â  <h1 class="text-4xl font-extrabold tracking-wide drop-shadow-lg">Askaio</h1>
Â  Â  Â  Â  Â  <button id="themeToggle" aria-label="Toggle Theme" class="w-12 h-12 flex items-center justify-center rounded-full bg-gray-700 hover:bg-gray-600 text-2xl transition-all">â˜€ï¸</button>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <p class="text-gray-400 leading-relaxed">Enter a descriptive prompt to generate a stunning AI-powered image. The more details you provide, the better your result!</p>
Â  Â  Â  Â  <textarea id="promptInput" placeholder="e.g., A futuristic neon city skyline at night with flying cars" class="prompt-box w-full h-40 p-4 rounded-xl border-2 border-[var(--color-primary-dark)] bg-gray-800 text-white resize-none focus:outline-none focus:ring-4 focus:ring-purple-400 transition-all"></textarea>
Â  Â  Â  Â  <button id="generateBtn" disabled class="w-full py-3 rounded-xl font-semibold bg-gradient-to-r from-purple-500 to-purple-700 text-white shadow-md hover:shadow-lg hover:scale-[1.02] transition-all">GENERATE IMAGE</button>
Â  Â  Â  </aside>

Â  Â  Â  <!-- Main Image Display -->
Â  Â  Â  <main class="image-area flex-1 flex justify-center items-center bg-[var(--color-panel-bg)] rounded-2xl shadow-lg overflow-hidden relative p-4" id="imageArea">
Â  Â  Â  Â  <div class="image-display w-full h-full flex justify-center items-center border-2 border-dashed border-[var(--color-border)] rounded-xl relative">
Â  Â  Â  Â  Â  <div id="loadingState" class="hidden flex flex-col items-center gap-4">
Â  Â  Â  Â  Â  Â  <div class="loading-spinner border-6 border-gray-600 border-t-[var(--color-primary)] rounded-full w-14 h-14 animate-spin"></div>
Â  Â  Â  Â  Â  Â  <p class="loading-message text-gray-400 italic">Generating your masterpiece...</p>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <img id="generatedImage" src="" alt="Generated Image" class="hidden max-w-full max-h-full rounded-lg shadow-lg transition-opacity duration-700">
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  <!-- Download Button - Only visible when an image is successfully loaded -->
Â  Â  Â  Â  Â  <button id="downloadBtn" class="absolute top-4 right-4 p-3 bg-purple-700/80 text-white rounded-full shadow-lg hover:bg-purple-600 transition-opacity duration-300 hidden z-10" aria-label="Download Image">
Â  Â  Â  Â  Â  Â  Â  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  <path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
Â  Â  Â  Â  Â  Â  Â  </svg>
Â  Â  Â  Â  Â  </button>

Â  Â  Â  Â  Â  <p id="placeholderText" class="text-gray-500 italic">Your generated image will appear here.</p>
Â  Â  Â  Â  Â  <p id="errorMessage" class="error-message text-red-400 font-semibold hidden"></p>
Â  Â  Â  Â  </div>
Â  Â  Â  </main>
Â  Â  </div>
Â  Â  <div class="bottom-tabs fixed bottom-0 left-0 w-full flex justify-around bg-[var(--color-panel-bg)] p-2 md:hidden">
Â  Â  Â  <button id="tabPrompt" class="flex-1 py-2 text-center active">Prompt</button>
Â  Â  Â  <button id="tabPreview" class="flex-1 py-2 text-center">Preview</button>
Â  Â  </div>
Â  </main>

Â  <!-- Public Auth Page (when logged out) -->
Â  <div id="public-auth" class="flex-1 hidden flex items-center justify-center p-4 relative">
Â  Â Â 
Â  Â  <!-- Landing Page: Initial View (Hero block) -->
Â  Â  <div id="public-landing" class="max-w-7xl w-full flex flex-col items-center justify-center space-y-16">
Â  Â  Â  Â Â 
Â  Â  Â  Â  <!-- Hero Content -->
Â  Â  Â  Â  <div class="text-center space-y-8 p-4 pt-10 md:pt-0">
Â  Â  Â  Â  Â  Â  <h2 class="text-6xl md:text-8xl font-extrabold leading-tight tracking-tighter text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-500 drop-shadow-2xl animate-pulse-slow">
Â  Â  Â  Â  Â  Â  Â  Â  Dream. Generate. Amaze.
Â  Â  Â  Â  Â  Â  </h2>
Â  Â  Â  Â  Â  Â  <p class="text-xl md:text-2xl text-gray-300 max-w-3xl mx-auto">
Â  Â  Â  Â  Â  Â  Â  Â  Transform your text ideas into stunning, high-resolution visual art in seconds. **Askaio** uses the latest diffusion models to bring your deepest creative concepts to life.
Â  Â  Â  Â  Â  Â  </p>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <!-- CTAs / Entry Point -->
Â  Â  Â  Â  <div class="flex flex-col sm:flex-row gap-6 justify-center">
Â  Â  Â  Â  Â  Â  <button id="showSignUp" class="flex items-center justify-center sm:w-60 py-4 rounded-full text-lg font-bold bg-gradient-to-r from-fuchsia-600 to-purple-700 text-white shadow-xl hover:shadow-fuchsia-500/50 hover:scale-[1.05] transition-all duration-300">
Â  Â  Â  Â  Â  Â  Â  Â  Start Generating Now
Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  <button id="showSignIn" class="flex items-center justify-center sm:w-60 py-4 rounded-full text-lg font-bold border-2 border-purple-500 text-purple-300 hover:bg-purple-900/40 hover:text-white transition-all duration-300">
Â  Â  Â  Â  Â  Â  Â  Â  Log In
Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  </div>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <!-- Mockup Visual -->
Â  Â  Â  Â  <div class="w-full max-w-5xl p-6 bg-[var(--color-panel-bg)] rounded-3xl border-2 border-purple-700/50 shadow-2xl shadow-purple-900/50 hidden md:block">
Â  Â  Â  Â  Â  Â  <div class="h-64 md:h-96 w-full rounded-2xl bg-gray-900 flex items-center justify-center overflow-hidden relative">
Â  Â  Â  Â  Â  Â  Â  Â  <img src="https://placehold.co/1200x600/1e293b/d1d5db?text=Breathtaking+AI+Art+Example" alt="AI Art Example" class="w-full h-full object-cover opacity-70">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="absolute inset-0 bg-black/30 flex items-center justify-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-white text-3xl font-semibold drop-shadow-lg">A New Canvas for Creativity</p>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  </div>
Â  Â Â 
Â  Â  <!-- Clerk Form Container (Hidden by default, shown as an overlay when a button is clicked) -->
Â  Â  <div id="clerk-form-container" class="absolute inset-0 z-50 flex items-center justify-center bg-black bg-opacity-80 hidden">
Â  Â  Â  Â  <div id="clerk-mount-target" class="p-4 w-full max-w-md">
Â  Â  Â  Â  Â  Â  <!-- Clerk mounts form here -->
Â  Â  Â  Â  </div>
Â  Â  </div>
Â  </div>


<style>
@media (min-width: 768px) {
Â  .bottom-tabs { display: none !important; }
Â  #sidebar { display: flex !important; }
Â  #imageArea { display: flex !important; }
}
@media (max-width: 767px) {
Â  #sidebar { display: flex; }
Â  #imageArea { display: none; }
}
.bottom-tabs button.active {
Â  color: white;
Â  background-color: var(--color-primary);
}
.bottom-tabs button {
Â  transition: background var(--transition-fast), color var(--transition-fast);
}
.bottom-tabs button:hover {
Â  background-color: rgba(255,255,255,0.05);
}
@media (max-width: 767px) {
Â  #sidebar, #imageArea {
Â  Â  display: none;
Â  }
Â  #sidebar.active, #imageArea.active {
Â  Â  display: flex !important;
Â  }
Â  .bottom-tabs { display: flex; }
}

.bottom-tabs button.active {
Â  color: white;
Â  background-color: var(--color-primary);
}
.bottom-tabs button {
Â  transition: background var(--transition-fast), color var(--transition-fast);
Â  border-radius: 6px;
}

/* Dark mode text color */
body:not(.light-mode) .bottom-tabs button {
Â  color: white;
}

/* Light mode text color */
body.light-mode .bottom-tabs button {
Â  color: black;
}

/* Active tab style */
.bottom-tabs button.active {
Â  color: white !important; /* always white on active */
Â  background-color: var(--color-primary);
}
.loading-spinner {
Â  border-width: 6px;
Â  border-style: solid;
Â  border-color: rgba(255,255,255,0.2);
Â  border-top-color: var(--color-primary);
}
#generatedImage {
Â  box-shadow: 0 0 20px rgba(168, 85, 247, 0.7);
}
body.light-mode {
Â  background: #f3f4f6;
Â  color: #1f2937;
}

body.light-mode .sidebar {
Â  background: #ffffff;
}

body.light-mode #promptInput {
Â  background: #ffffff;
Â  color: #111827;
Â  border-color: #d1d5db;
}

body.light-mode #imageArea {
Â  background: #ffffff;
Â  border-color: #d1d5db;
}

body.light-mode #placeholderText {
Â  color: #6b7280;
}

body.light-mode #generateBtn {
Â  background: linear-gradient(to right, #6366f1, #4f46e5);
}

body.light-mode .image-display {
Â  border-color: #d1d5db;
}

body.light-mode #errorMessage {
Â  color: #dc2626;
}
body.light-mode header {
Â  background: #ffffff;
}
body.light-mode #themeToggle {
Â  background: #e5e7eb; /* light gray */
Â  color: #1f2937; /* dark text */
}
body.light-mode #themeToggle:hover {
Â  background: #d1d5db; /* slightly darker gray */
}

body.light-mode .sidebar {
Â  background: #e5e7eb;
}

</style>
<script>
// Define the custom Clerk appearance once
const clerkAppearance = {
Â  Â  elements: {
Â  Â  Â  Â  // Light background, subtle shadow, and light border
Â  Â  Â  Â  card: "bg-white shadow-2xl rounded-2xl p-6 border border-gray-200",
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Darker text for titles on a light background, keeping the purple accent
Â  Â  Â  Â  headerTitle: "text-3xl font-extrabold text-purple-700 tracking-wide",
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Lighter gray subtitle
Â  Â  Â  Â  headerSubtitle: "text-gray-500 italic",
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Primary button with a vibrant gradient, now starting from lighter shades
Â  Â  Â  Â  formButtonPrimary:Â 
Â  Â  Â  Â  Â  Â  "bg-gradient-to-r from-purple-500 via-fuchsia-600 to-pink-600 text-white font-semibold py-2 px-4 rounded-xl shadow-lg hover:scale-[1.05] hover:shadow-purple-400/50 transition-all",
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Light input field with a subtle border and dark text
Â  Â  Â  Â  formFieldInput:Â 
Â  Â  Â  Â  Â  Â  "bg-gray-50 border border-purple-300 text-gray-800 placeholder-gray-400 rounded-lg px-3 py-2 focus:ring-2 focus:ring-fuchsia-500",
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Accent link color for the footer, standing out against the light background
Â  Â  Â  Â  footerActionLink:Â 
Â  Â  Â  Â  Â  Â  "text-purple-600 hover:text-fuchsia-500 font-semibold transition-colors",
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Social buttons with light background and colored border/text
Â  Â  Â  Â  socialButtonsBlockButton:Â 
Â  Â  Â  Â  Â  Â  "bg-white border border-purple-300 text-purple-600 rounded-lg px-4 py-2 hover:bg-purple-50 hover:text-purple-700 transition-all",
Â  Â  },
Â  Â Â 
Â  Â  // Layout remains the same
Â  Â  layout: {
Â  Â  Â  Â  socialButtonsPlacement: "bottom",
Â  Â  Â  Â  logoPlacement: "none",
Â  Â  },
Â  Â Â 
Â  Â  // Variable changes for a light theme
Â  Â  variables: {
Â  Â  Â  Â  colorPrimary: "#a855f7", // Same purple accent
Â  Â  Â  Â  colorBackground: "transparent", // Use the surrounding light background
Â  Â  Â  Â  colorText: "#1f2937", // Dark text color for readability on a light background (text-gray-800 equivalent)
Â  Â  },
};

// New elements for the auth gateway
const publicLanding = document.getElementById("public-landing");
const clerkFormContainer = document.getElementById("clerk-form-container");
// Added new reference for the dedicated mount target
const clerkMountTarget = document.getElementById("clerk-mount-target");
const showSignInBtn = document.getElementById("showSignIn");
const showSignUpBtn = document.getElementById("showSignUp");

/**
Â * Hides the landing page and mounts the appropriate Clerk form (Sign In or Sign Up).
Â * @param {'signIn' | 'signUp'} type - The type of form to mount.
Â */
function showForm(type) {
Â  Â  // Hide the landing page and show the form container
Â  Â  publicLanding.classList.add("hidden");
Â  Â  clerkFormContainer.classList.remove("hidden");
Â  Â Â 
Â  Â  // Crucial Fix: Clear the mount target's content, but do not delete the element itself.
Â  Â  clerkMountTarget.innerHTML = '';Â 

Â  Â  if (type === 'signIn') {
Â  Â  Â  Â  Clerk.mountSignIn(clerkMountTarget, { // Use the dedicated mount target
Â  Â  Â  Â  Â  Â  appearance: clerkAppearance,
Â  Â  Â  Â  Â  Â  // Ensure internal links within the Clerk form switch views correctly
Â  Â  Â  Â  Â  Â  initialState: {
Â  Â  Â  Â  Â  Â  Â  Â  onSwitchToSignUp: () => showForm('signUp')Â 
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  } else { // type === 'signUp'
Â  Â  Â  Â  Clerk.mountSignUp(clerkMountTarget, { // Use the dedicated mount target
Â  Â  Â  Â  Â  Â  appearance: clerkAppearance,
Â  Â  Â  Â  Â  Â  // Ensure internal links within the Clerk form switch views correctly
Â  Â  Â  Â  Â  Â  initialState: {
Â  Â  Â  Â  Â  Â  Â  Â  onSwitchToSignIn: () => showForm('signIn')
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  }
}

// === FIX: Changed 'window.addEventListener("load", ...)' to 'document.addEventListener("DOMContentLoaded", ...)'
// This ensures Clerk starts loading as soon as the DOM structure is ready, improving responsiveness.
document.addEventListener("DOMContentLoaded", async () => {
Â  await Clerk.load();

Â  if (!Clerk.user) {
Â  Â  document.getElementById("protected-content").classList.add("hidden");
Â  Â  document.getElementById("public-auth").classList.remove("hidden");

Â  Â  // Start by showing the friendly landing page (Hero)
Â  Â  publicLanding.classList.remove("hidden");
Â  Â  clerkFormContainer.classList.add("hidden");
Â  Â Â 
Â  Â  // Attach event listeners to the new buttons
Â  Â  if (showSignInBtn) showSignInBtn.addEventListener('click', () => showForm('signIn'));
Â  Â  if (showSignUpBtn) showSignUpBtn.addEventListener('click', () => showForm('signUp'));
Â  } else {
Â  Â  document.getElementById("protected-content").classList.remove("hidden");
Â  Â  document.getElementById("public-auth").classList.add("hidden");
Â  }

Â  // Mount the user button in the header (space theme ğŸ‘¨â€ğŸš€)
Â  Clerk.mountUserButton(document.getElementById("clerk-user-button"), {
Â  Â  appearance: {
Â  Â  Â  elements: {
Â  Â  Â  Â  avatarBox:
Â  Â  Â  Â  Â  "ring-2 ring-purple-500 hover:ring-fuchsia-400 transition-all shadow-md",
Â  Â  Â  Â  userButtonPopoverCard:
Â  Â  Â  Â  Â  "bg-gradient-to-br from-[#1a102b] to-[#0b0f24] border border-purple-700/40 rounded-xl shadow-2xl",
Â  Â  Â  Â  userButtonPopoverActionButton:
Â  Â  Â  Â  Â  "hover:bg-purple-800/40 text-purple-200 px-3 py-2 rounded-lg transition-all",
Â  Â  Â  },
Â  Â  },
Â  });

Â  // Listen for sign in/out events
Â  Clerk.addListener(({ user }) => {
Â  Â  if (user) {
Â  Â  Â  document.getElementById("protected-content").classList.remove("hidden");
Â  Â  Â  document.getElementById("public-auth").classList.add("hidden");
Â  Â  Â  publicLanding.classList.remove("hidden"); // Reset state
Â  Â  Â  clerkFormContainer.classList.add("hidden");
Â  Â  } else {
Â  Â  Â  document.getElementById("protected-content").classList.add("hidden");
Â  Â  Â  document.getElementById("public-auth").classList.remove("hidden");
Â  Â  Â  // Show landing page again on sign out
Â  Â  Â  publicLanding.classList.remove("hidden");Â 
Â  Â  Â  clerkFormContainer.classList.add("hidden");
Â  Â  }
Â  });
});
// === END OF FIX

const apiKey = "AIzaSyD8xBXpp0FYeV0nCxZ9V_VtVjKwoo6_BUw";
const sidebar = document.getElementById('sidebar');
const imageArea = document.getElementById('imageArea');
const promptInput = document.getElementById('promptInput');
const generateBtn = document.getElementById('generateBtn');
const generatedImageDisplay = document.getElementById('generatedImage');
const loadingState = document.getElementById('loadingState');
const placeholderText = document.getElementById('placeholderText');
const errorMessage = document.getElementById('errorMessage');
const themeToggle = document.getElementById('themeToggle');
const body = document.body;
// New reference for the download button
const downloadBtn = document.getElementById('downloadBtn');

const tabPrompt = document.getElementById('tabPrompt');
const tabPreview = document.getElementById('tabPreview');

function showLoading(show) {
Â  if (show) {
Â  Â  loadingState.classList.remove('hidden');
Â  Â  generatedImageDisplay.classList.add('hidden');
Â  Â  placeholderText.classList.add('hidden');
Â  Â  errorMessage.classList.add('hidden');
Â  Â  // Hide download button when generating or before success
Â  Â  downloadBtn.classList.add('hidden');
Â  } else {
Â  Â  loadingState.classList.add('hidden');
Â  }
}

/**
Â * Disables/enables the generate button and updates its appearance.
Â * @param {boolean} disabled - True to disable and show loading state, false to re-enable.
Â */
function toggleButtons(disabled) {
Â  const isPromptEmpty = promptInput.value.trim() === '';
Â  generateBtn.disabled = disabled || isPromptEmpty;

Â  if (disabled) {
Â  Â  generateBtn.textContent = 'GENERATING...';
Â  Â  generateBtn.classList.add('opacity-70', 'cursor-not-allowed');
Â  Â  generateBtn.classList.remove('hover:scale-[1.02]', 'shadow-md', 'hover:shadow-lg');
Â  } else {
Â  Â  generateBtn.textContent = 'GENERATE IMAGE';
Â  Â  generateBtn.classList.remove('opacity-70', 'cursor-not-allowed');
Â  Â  if (!isPromptEmpty) {
Â  Â  Â  Â  generateBtn.classList.add('hover:scale-[1.02]', 'shadow-md', 'hover:shadow-lg');
Â  Â  }
Â  }
}

/**
 * Generates a 10-digit random number string for unique filenames.
 * @returns {string} A 10-digit random number string.
 */
function generateRandomId() {
    // Ensure the number is 10 digits by multiplying by 10^10 and padding with leading zeros.
    return Math.floor(Math.random() * 10000000000).toString().padStart(10, '0');
}

/**
 * Handles the download of the generated image, using a unique filename.
 */
function downloadImage() {
    const imageData = generatedImageDisplay.src;
    if (imageData && imageData !== 'data:image/png;base64,') {
        const link = document.createElement('a');
        link.href = imageData;
        // Generate a unique filename using a 10-digit random ID
        const randomId = generateRandomId();
        link.download = `askaio_generated_image${randomId}.png`;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }
}

document.addEventListener('DOMContentLoaded', () => {
Â  const savedTheme = localStorage.getItem('theme');

Â  // Default theme logic
Â  if (!savedTheme || savedTheme === 'light') {
Â  Â  body.classList.add('light-mode');
Â  Â  themeToggle.textContent = 'ğŸŒ™';
Â  Â  localStorage.setItem('theme', 'light');
Â  } else {
Â  Â  themeToggle.textContent = 'â˜€ï¸';
Â  }

Â  // Set bottom tab text colors on load
Â  document.querySelectorAll('.bottom-tabs button').forEach(btn => {
Â  Â  btn.style.color = (!savedTheme || savedTheme === 'light') ? 'black' : 'white';
Â  });

Â  promptInput.addEventListener('input', () => {
Â  Â  // Only toggle based on empty state if we are NOT currently generating
Â  Â  if (generateBtn.textContent !== 'GENERATING...') {
Â  Â  Â  Â  toggleButtons(false);Â 
Â  Â  }
Â  });

Â  // Mobile default: show prompt tab
Â  if (window.innerWidth < 768) {
Â  Â  activateTab('prompt');
Â  }
Â Â 
Â  // Attach download handler
Â  downloadBtn.addEventListener('click', downloadImage);
});

themeToggle.addEventListener('click', () => {
Â  body.classList.toggle('light-mode');
Â  const isLight = body.classList.contains('light-mode');
Â  themeToggle.textContent = isLight ? 'ğŸŒ™' : 'â˜€ï¸';
Â  localStorage.setItem('theme', isLight ? 'light' : 'dark');

Â  // Update bottom tab text colors instantly
Â  document.querySelectorAll('.bottom-tabs button').forEach(btn => {
Â  Â  btn.style.color = isLight ? 'black' : 'white';
Â  });
});

async function generateImage() {
Â  const prompt = promptInput.value.trim();
Â  if (!prompt) return;

Â  // 1. Immediately disable button, show loading, and HIDE download button
Â  toggleButtons(true);Â 
Â  showLoading(true);
Â  downloadBtn.classList.add('hidden'); // Ensure it is hidden

Â  // Simple retry mechanism with exponential backoff
Â  const maxRetries = 3;
Â  let attempt = 0;
Â  let success = false;
Â  let base64Data = null;
Â  let lastError = null;

Â  while (attempt < maxRetries && !success) {
Â  Â  Â  try {
Â  Â  Â  Â  Â  const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-preview-image-generation:generateContent?key=${apiKey}`;
Â  Â  Â  Â  Â  const payload = { contents: [{ parts: [{ text: prompt }] }], generationConfig: { responseModalities: ['TEXT','IMAGE'] } };
Â  Â  Â  Â  Â  const response = await fetch(apiUrl, {Â 
Â  Â  Â  Â  Â  Â  Â  method: 'POST',Â 
Â  Â  Â  Â  Â  Â  Â  headers: { 'Content-Type': 'application/json' },Â 
Â  Â  Â  Â  Â  Â  Â  body: JSON.stringify(payload)Â 
Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  if (!response.ok) {
Â  Â  Â  Â  Â  Â  Â  throw new Error(`API returned status ${response.status}`);
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  const result = await response.json();
Â  Â  Â  Â  Â  base64Data = result?.candidates?.[0]?.content?.parts?.find(p => p.inlineData)?.inlineData?.data;
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  if (base64Data) {
Â  Â  Â  Â  Â  Â  Â  success = true;
Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  throw new Error("No image data found in response.");
Â  Â  Â  Â  Â  }
Â  Â  Â  } catch (err) {
Â  Â  Â  Â  Â  lastError = err;
Â  Â  Â  Â  Â  attempt++;
Â  Â  Â  Â  Â  if (attempt < maxRetries) {
Â  Â  Â  Â  Â  Â  Â  const delay = Math.pow(2, attempt) * 1000; // 2s, 4s, 8s
Â  Â  Â  Â  Â  Â  Â  await new Promise(resolve => setTimeout(resolve, delay));
Â  Â  Â  Â  Â  }
Â  Â  Â  }
Â  }

Â  // 2. Display result or error
Â  if (base64Data) {
Â  Â  generatedImageDisplay.src = `data:image/png;base64,${base64Data}`;
Â  Â  generatedImageDisplay.classList.remove('hidden');
Â  Â  placeholderText.classList.add('hidden');
Â  Â  errorMessage.classList.add('hidden');
Â  Â  // SHOW download button on success
Â  Â  downloadBtn.classList.remove('hidden');Â 
Â  } else {
Â  Â  errorMessage.textContent = `Error generating image. Please try again. Last attempt failed: ${lastError ? lastError.message : 'Unknown error.'}`;
Â  Â  errorMessage.classList.remove('hidden');
Â  Â  // Ensure download button remains hidden on failure
Â  Â  downloadBtn.classList.add('hidden');Â 
Â  }

Â  // 3. Re-enable button
Â  toggleButtons(false);Â 
Â  showLoading(false);
}

generateBtn.addEventListener('click', generateImage);

// Mobile tab switching
function activateTab(tab) {
Â  tabPrompt.classList.remove('active');
Â  tabPreview.classList.remove('active');
Â  sidebar.classList.remove('active');
Â  imageArea.classList.remove('active');

Â  if (tab === 'prompt') {
Â  Â  tabPrompt.classList.add('active');
Â  Â  sidebar.classList.add('active');
Â  } else {
Â  Â  tabPreview.classList.add('active');
Â  Â  imageArea.classList.add('active');
Â  }
}

tabPrompt.addEventListener('click', () => activateTab('prompt'));
tabPreview.addEventListener('click', () => activateTab('preview'));
</script>

</body>
</html>
